{% extends 'index/base.html' %}


{% block title %}
<title>Dublin Bus Prediction</title>
{% endblock %}


{% block main %}
<script>
    <!--$(document).ready(function(){-->
        <!--if($(window).width() <= 1200) {-->
            <!--window.location = "/indexmobile/";-->
        <!--}-->
    <!--});-->
    $(window).resize(function(){location.reload();});
    /*
     var user_name;
     var expires = new Date();
     var length = document.cookie.length -1;
     var message = document.cookie.substring(5, length)
     document.write("<h5><center> Welcome Back, " + message + "!</center></h5>")
     function cookierun(){
     user_name = document.getElementById("name").value;
     expires.setFullYear(expires.getFullYear()+1);
     document.cookie = escape("name") + "=" + escape(user_name) + "; expires = " + expires.toUTCString();
     window.alert(document.cookie);
     }
     */
    $(function() {
          navigator.geolocation.getCurrentPosition(function(position) {
                document.getElementById("setvalue").value = [position.coords.latitude, position.coords.longitude];
                                });
        var td = new Date().getDay();
        td = (td == 0) ? 7 : td;
        $("select[id=day]").find("option").eq(td).prop("selected", true).end().change();
        var data = [{
            "Timestamp": "2012-11-07 09:26:50",
            "LineID": "145",
            "Direction": 0,
            "JourneyPatternID": "null",
            "TimeFrame": "2012-11-07",
            "VehicleJourneyID": 6745,
            "Operator": "D1",
            "Congestion": 0,
            "Lon": -6.292033,
            "Lat": 53.346668,
            "Delay": 0,
            "BlockID": 145107,
            "VehicleID": 38029,
            "StopID": "4320",
            "AtStop": 1,
            "Route_number": "145"
        }];
        $.each(data, function(i, option) {
            $("#RouteNumbers").append($("<option/>").attr("value", option.LineID).text(option.Route_number));
        });
    });
function populate(route, dict) {
     route = route;
     var zero = [dict[route]['0']];
     var one = [dict[route]['1']];
     var all_stops = zero.concat(one);

     var array = JSON.parse("["+all_stops+"]");
     <!--array.sort(function(a, b){return a-b});-->
     var dropdown = document.getElementById("origin");
     while (dropdown.options.length > 0) {
        dropdown.remove(0);
    }
     var option = document.createElement("option");
     option.text = "Select an Origin Stop";
     dropdown.add(option);

     for (var i = 0; i < array.length; ++i) {
          var option = document.createElement("option");
          option.text = array[i];
          dropdown.add(option);
     }

     var desti = document.getElementById("destination");
     while (desti.options.length > 0) {
        desti.remove(0);
     }
     var option = document.createElement("option");
     option.text = "Select Origin Stop First";
     desti.add(option);

}

function populateDestination(start, dict) {
    var route = document.getElementById("RouteNumbers").value;
    var subset;
    if ($.inArray(start, dict[route]['0']) != -1){
        subset = dict[route]['0'].slice($.inArray(start, dict[route]['0'])+1, );
    }
    if ($.inArray(start, dict[route]['1']) != -1){
        var temp = dict[route]['1'].slice($.inArray(start, dict[route]['1'])+1, );
        if(typeof str1 == 'undefined'){
            subset = temp;
        }
        else {
            subset = subset.concat(temp);
        }
    }

     var dropdown = document.getElementById("destination");
     while (dropdown.options.length > 0) {
        dropdown.remove(0);
     }

     var option = document.createElement("option");
     option.text = "Select a Destination Stop";
     dropdown.add(option);
     destination.options[destination.options.selectedIndex].setAttribute("selected", "selected");

     for (var i = 0; i < subset.length; ++i) {
          var option = document.createElement("option");
          option.text = subset[i];
          dropdown.add(option);
     }

}


     </script>

<div id="homepage">
     <div id="main">
          <h1 id = 'heading'>Dublin Bus Dynamic Travel</h1>
     </div>
     <!--<div id="welcome_message">
         <p>Welcome to the Dublin Bus Dynamic Travel App {{ x }}</p>
     </div> -->
     <div id="center">
          <!--
          Name = <input type="text" id="name"/>
          <input type="button" value="Enter" id="cookierun()"/>
          -->
          <form action='detail/' method="post" autocomplete="off">
               {% csrf_token %}
               <div class="form-group">
                    <label for ="RouteNumbers">Route Number</label>
                    <select onchange="populate(value, {{ dicty }})" name="route" class="form-control" id="RouteNumbers">
                    <option selected value="0">
                         Select Route
                    </option>
                    {% for i in routes %}
                    <option value={{ i }} >
                         {{ i }}
                    </option>
                    {% endfor %}
               </select>
               </div>
               <div class="form-group">
                    <label for="origin">Origin Stop</label>
                    <select onchange="populateDestination(value, {{ dicty }})" name = "orig" class="form-control" id="origin">
                    <option selected value="0">
                         Select Route First
                    </option>
               </select>
               </div>
               <div class="form-group">
                    <label for ="destination">Destination Stop</label> <select name="dest" class="form-control" id="destination">
                    <option selected value="0">
                         Select Route First
                    </option>
               </select>
               </div>

               <div class="form-group">
                    <label for="time">Time</label> <select name="time" class="form-control" id="time">
                    <option selected value="0">
                         What time are you planning for?
                    </option>
                    <option selected value="">
                         Right now!
                    </option>
                    {% for i in hours %}
                         {% for j in mins %}
                              <option value=({{ i }}.{{ j }})>
                                   {{ i }}.{{ j }}
                              </option>
                         {% endfor %}
                    {% endfor %}
                    <option value="0">
                         00.00
                    </option>
               </select>
               </div>
               <div class="form-group">
                    <label for ="day">Day</label> <select name = "day" class="form-control" id="day">
                    <option selected value="">
                    </option>
                    <option value="Monday1">
                         Monday
                    </option>
                    <option value="Tuesday2">
                         Tuesday
                    </option>
                    <option value="Wednesday3">
                         Wednesday
                    </option>
                    <option value="Thursday4">
                         Thursday
                    </option>
                    <option value="Friday5">
                         Friday
                    </option>
                    <option value="Saturday6">
                         Saturday
                    </option>
                    <option value="Sunday7">
                         Sunday
                    </option>
               </select>
               </div>
               <input type="submit" value="OK">
               <!--<button class="btn btn-danger" onclick="greeting()" type="button" >Submit</button>-->

          </form>
          <br>
          <form action ="find/"  method ="post">
               {% csrf_token %}
               <button class="btn btn-info" id = "setvalue" name = "current" value = "" type="submit">Not sure? Find Your Closest Bus Stops!</button>
               <p id="demo"></p>
          </form>
     </div>
</div>


{% endblock %}